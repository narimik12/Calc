<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2a2a40">
<link rel="manifest" href="manifest.json">
<title>3D Print Calculator</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #1e1e2f, #2a2a40);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    color: white;
}

.container {
    background: #2f2f45;
    padding: 30px;
    border-radius: 25px;
    width: 95%;
    max-width: 420px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.6);
    text-align: center;
}

h2 { margin-bottom: 20px; }

button {
    width: 100%;
    padding: 14px;
    border-radius: 14px;
    border: none;
    font-size: 16px;
    margin: 8px 0;
    cursor: pointer;
    transition: 0.2s;
}

.primary { background: #4CAF50; color: white; }
.secondary { background: #3a3a55; color: white; }

.activeMaterial {
    background: #4CAF50 !important;
}

input {
    width: 100%;
    padding: 14px;
    margin: 10px 0;
    border-radius: 14px;
    border: none;
    font-size: 16px;
    background: #3a3a55;
    color: white;
}

.result {
    margin-top: 20px;
    line-height: 1.6;
}

.highlight {
    font-weight: bold;
    font-size: 18px;
}
</style>
</head>

<body>

<div class="container">

    <!-- ОСНОВНОЙ ИНТЕРФЕЙС -->
    <div id="mainInterface">

        <h2>3D Print Calculator</h2>

        <button class="secondary" onclick="setPETG()">PETG (750 ₽/кг)</button>
        <button class="secondary" onclick="setCustom()">Своя цена</button>

        <input type="number" id="customPrice" placeholder="Цена за кг (₽)" style="display:none;">

        <input type="number" id="weight" placeholder="Вес модели (граммы)">
        <input type="number" id="printTime" placeholder="Время печати (минуты)">

        <button class="primary" onclick="calculate()">Посчитать</button>

        <div class="result" id="result"></div>

        <hr style="margin:20px 0; opacity:0.3;">

        <button class="secondary" onclick="openConverter()">Метры → Граммы</button>

    </div>

    <!-- КОНВЕРТЕР -->
    <div id="converterInterface" style="display:none;">

        <h2>Метры → Граммы</h2>

        <button class="secondary" id="plaBtn" onclick="setPLA()">PLA</button>
        <button class="secondary" id="petgBtn" onclick="setPETGConverter()">PETG</button>

        <input type="number" id="meters" placeholder="Длина (метры)">

        <button class="primary" onclick="convertMeters()">Рассчитать</button>

        <div class="result" id="converterResult"></div>

        <button class="secondary" onclick="goBack()">Назад</button>

    </div>

</div>

<script>

let plasticCostPerGram = 0.75;
let meterCoefficient = 2.98; // PLA по умолчанию

function setPETG() {
    plasticCostPerGram = 0.75;
    document.getElementById("customPrice").style.display = "none";
}

function setCustom() {
    document.getElementById("customPrice").style.display = "block";
}

function calculate() {

    let weight = parseFloat(document.getElementById("weight").value);
    let printMinutes = parseFloat(document.getElementById("printTime").value);
    let customPrice = parseFloat(document.getElementById("customPrice").value);

    if (document.getElementById("customPrice").style.display === "block" && !isNaN(customPrice)) {
        plasticCostPerGram = customPrice / 1000;
    }

    if (isNaN(weight) || isNaN(printMinutes) || weight <= 0 || printMinutes <= 0) {
        document.getElementById("result").innerHTML = "Введите корректные данные!";
        return;
    }

    let servicePerHour = 62.5;
    let profitPercent = 1.3;

    let printHours = printMinutes / 60;

    let plastic = weight * plasticCostPerGram;
    let service = printHours * servicePerHour;

    let cost = plastic + service;
    let finalPrice = cost * profitPercent;

    document.getElementById("result").innerHTML =
        "Себестоимость: <span class='highlight'>" + cost.toFixed(2) + " ₽</span><br><br>" +
        "Цена с прибылью: <span class='highlight'>" + finalPrice.toFixed(2) + " ₽</span><br><br>" +
        "Цена за грамм: <span class='highlight'>" + (finalPrice / weight).toFixed(2) + " ₽</span>";
}

/* --- ПЕРЕКЛЮЧЕНИЕ ИНТЕРФЕЙСА --- */

function openConverter() {
    document.getElementById("mainInterface").style.display = "none";
    document.getElementById("converterInterface").style.display = "block";
}

function goBack() {
    document.getElementById("converterInterface").style.display = "none";
    document.getElementById("mainInterface").style.display = "block";
}

/* --- ВЫБОР МАТЕРИАЛА --- */

function setPLA() {
    meterCoefficient = 2.98;

    document.getElementById("plaBtn").classList.add("activeMaterial");
    document.getElementById("petgBtn").classList.remove("activeMaterial");
}

function setPETGConverter() {
    meterCoefficient = 3.05;

    document.getElementById("petgBtn").classList.add("activeMaterial");
    document.getElementById("plaBtn").classList.remove("activeMaterial");
}

/* --- КОНВЕРТАЦИЯ --- */

function convertMeters() {

    let meters = parseFloat(document.getElementById("meters").value);

    if (isNaN(meters) || meters <= 0) {
        document.getElementById("converterResult").innerHTML = "Введите корректные данные!";
        return;
    }

    let grams = meters * meterCoefficient;

    document.getElementById("converterResult").innerHTML =
        "Вес: <span class='highlight'>" + grams.toFixed(2) + " г</span>";
}

/* PLA активен по умолчанию */
setPLA();

</script>

<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>

